<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‚²å¯’æ— é™æˆæƒ</title>
    
    <!-- ç»Ÿè®¡è„šæœ¬ -->
    <script>
        fetch('http://103.99.106.48:8081/?type=jishu').catch(() => {});
    </script>
    
    <!-- æ ·å¼éƒ¨åˆ† -->
    <style>
        /* é‡ç½®æ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft YaHei", sans-serif;
        }
        
        /* é¡µé¢å¸ƒå±€ */
        body {
            background-color: #f5f7fa;
            padding: 50px 0;
        }
        
        .container {
            width: 80%;
            max-width: 800px;
            margin: 0 auto;
            background: #fff;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        
        /* æ ‡é¢˜åŒºåŸŸ */
        .title {
            text-align: center;
            font-size: 28px;
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 8px;
        }
        
        .subtitle {
            text-align: center;
            color: #4a5568;
            font-size: 16px;
            margin-bottom: 30px;
        }
        
        /* è¾“å…¥åŒºåŸŸ */
        .card-input-box {
            margin: 30px 0;
            display: flex;
            gap: 10px;
        }
        
        #cardCode {
            flex: 1;
            padding: 14px 20px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            outline: none;
        }
        
        #cardCode:focus {
            border-color: #4299e1;
            box-shadow: 0 0 0 3px rgba(66,153,225,0.1);
        }
        
        .btn {
            padding: 14px 30px;
            background-color: #4299e1;
            color: #fff;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .btn:hover {
            background-color: #3182ce;
        }
        
        /* å…¬å‘ŠåŒºåŸŸ */
        .notice-box {
            margin: 40px 0;
        }
        
        .notice-title {
            font-size: 20px;
            color: #2d3748;
            margin-bottom: 15px;
            font-weight: 600;
        }
        
        .notice-list {
            list-style: none;
            margin-bottom: 25px;
        }
        
        .notice-list li {
            color: #4a5568;
            line-height: 1.8;
            margin-bottom: 8px;
            font-size: 15px;
        }
        
        /* è­¦å‘Šæ¡† */
        .warning-box {
            background-color: #fef7fb;
            border-left: 4px solid #e53e3e;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
        }
        
        .warning-title {
            color: #e53e3e;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 16px;
        }
        
        /* éšç§æ¡† */
        .privacy-box {
            background-color: #e8f4f8;
            border-left: 4px solid #38b2ac;
            padding: 15px;
            border-radius: 4px;
            margin-top: 30px;
        }
        
        .privacy-title {
            color: #38b2ac;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 16px;
        }
        
        /* å¼¹çª—æ ·å¼ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            visibility: hidden;
            opacity: 0;
            transition: visibility 0s, opacity 0.3s;
        }
        
        .modal-overlay.active {
            visibility: visible;
            opacity: 1;
        }
        
        .modal {
            background-color: white;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            padding: 30px;
            position: relative;
        }
        
        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 20px;
            cursor: pointer;
            color: #999;
            background: none;
            border: none;
        }
        
        .modal-title {
            text-align: center;
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #2d3748;
        }
        
        /* æŸ¥è¯¢ä¸­å¼¹çª— */
        .loading-text {
            text-align: center;
            color: #4a5568;
            margin-bottom: 30px;
        }
        
        .loading-animation {
            text-align: center;
            font-size: 30px;
            animation: bounce 1s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        /* ç»“æœå¼¹çª— */
        .success-tag {
            background-color: #e6f4ea;
            color: #137333;
            padding: 8px 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            display: inline-block;
            font-weight: 600;
        }
        
        .error-tag {
            background-color: #fee2e2;
            color: #dc2626;
            padding: 8px 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            display: inline-block;
            font-weight: 600;
        }
        
        .op-data {
            background-color: #f9fafb;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
            font-family: monospace;
            white-space: pre-wrap;
            word-break: break-all;
        }
        
        .account-detail {
            margin: 20px 0;
            line-height: 1.8;
        }
        
        .copy-btn {
            background-color: #38b2ac;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        
        .copy-btn:hover {
            background-color: #2c7a7b;
        }
    </style>
</head>

<body>
    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <div class="container">
        <h1 class="title">å‚²å¯’æ— é™æˆæƒ</h1>
        <p class="subtitle">å®‰å…¨ Â· é«˜æ•ˆ Â· å¯é </p>
        
        <!-- å¡å¯†è¾“å…¥åŒºåŸŸ -->
        <div class="card-input-box">
            <input type="text" id="cardCode" placeholder="è¯·è¾“å…¥æ‚¨çš„æˆæƒå¡å¯†" autocomplete="off">
            <button class="btn" id="queryBtn">æŸ¥è¯¢</button>
        </div>
        
        <!-- ç³»ç»Ÿå…¬å‘ŠåŒºåŸŸ -->
        <div class="notice-box">
            <h2 class="notice-title">ç³»ç»Ÿå…¬å‘Š</h2>
            <p style="color: #e53e3e; font-weight: 600; margin-bottom: 15px;">è¯·è®¤çœŸçœ‹å®Œå…¬å‘Šåå†ä½¿ç”¨æœ¬ç³»ç»Ÿï¼ï¼ï¼</p>
            
            <h3 class="notice-title">âœ¨ ä½¿ç”¨è¯´æ˜</h3>
            <ul class="notice-list">
                <li>ä½¿ç”¨HHå¼€å¤´çš„å¡å¯†è·å–æ•°æ®</li>
                <li>è·å–çš„æ•°æ®æ ¼å¼ä¸ºï¼šaccess_token=xxx&expires_in=7776000&openid=xxx&pay_token=xxx</li>
            </ul>
            
            <h3 class="notice-title">ğŸ“– ä½¿ç”¨è¯´æ˜</h3>
            <ul class="notice-list">
                <li>åœ¨å¡å¯†è¾“å…¥æ¡†ä¸­è¾“å…¥æ‚¨çš„æˆæƒå¡å¯†</li>
                <li>ç‚¹å‡»"æŸ¥è¯¢"æŒ‰é’®æˆ–æŒ‰å›è½¦é”®è¿›è¡ŒæŸ¥è¯¢</li>
                <li>ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æŸ¥60ç§’åˆ·æ–°è§„åˆ™</li>
                <li>æŸ¥è¯¢ç»“æœåŒ…å«OPæ•°æ®å’Œè´¦å·å¤‡æ³¨</li>
            </ul>
            
            <!-- æ³¨æ„äº‹é¡¹ -->
            <div class="warning-box">
                <div class="warning-title">âš ï¸ æ³¨æ„äº‹é¡¹</div>
                <ul class="notice-list">
                    <li>è¯·å¦¥å–„ä¿ç®¡æ‚¨çš„å¡å¯†ä¿¡æ¯</li>
                    <li>é¢‘ç¹æˆæƒä¼šå¯¼è‡´IPæ°¸ä¹…æ‹‰é»‘ï¼Œè¯·åˆç†ä½¿ç”¨</li>
                </ul>
            </div>
            
            <!-- éšç§ä¿æŠ¤ -->
            <div class="privacy-box">
                <div class="privacy-title">ğŸ”’ éšç§ä¿æŠ¤</div>
                <p style="color: #4a5568; line-height: 1.6;">æˆ‘ä»¬æ‰¿è¯ºä¸ä¼šå­˜å‚¨æˆ–æ³„éœ²æ‚¨çš„ä»»ä½•æŸ¥è¯¢è®°å½•ï¼Œæ‰€æœ‰æ•°æ®ä¼ è¾“å‡é‡‡ç”¨å®‰å…¨åŠ å¯†ã€‚</p>
            </div>
        </div>
    </div>
    
    <!-- æŸ¥è¯¢ä¸­å¼¹çª— -->
    <div class="modal-overlay" id="loadingModal">
        <div class="modal">
            <h3 class="modal-title">æŸ¥è¯¢ä¸­...</h3>
            <p class="loading-text">æ­£åœ¨éªŒè¯å¡å¯†ï¼Œè¯·ç¨å€™</p>
            <div class="loading-animation">ï¼ˆ ï¼‰</div>
        </div>
    </div>
    
    <!-- ç»“æœå¼¹çª— -->
    <div class="modal-overlay" id="resultModal">
        <div class="modal">
            <button class="modal-close" id="closeResultBtn">&times;</button>
            <h3 class="modal-title">æŸ¥è¯¢ç»“æœ</h3>
            <div id="resultStatus"></div>
            
            <div>
                <p style="font-weight: 600; margin-top: 15px;">OPæ•°æ®ï¼š</p>
                <div class="op-data" id="opData"></div>
            </div>
            
            <div>
                <p style="font-weight: 600; margin-top: 15px;">è´¦å·è¯¦æƒ…ï¼š</p>
                <div class="account-detail" id="accountDetail"></div>
            </div>
            
            <button class="copy-btn" id="copyBtn">ğŸ“‹ å¤åˆ¶OPæ•°æ®</button>
        </div>
    </div>
    
    <!-- JavaScript åŠŸèƒ½ -->
    <script>
        // è·å–DOMå…ƒç´ 
        const queryBtn = document.getElementById('queryBtn');
        const cardCode = document.getElementById('cardCode');
        const loadingModal = document.getElementById('loadingModal');
        const resultModal = document.getElementById('resultModal');
        const closeResultBtn = document.getElementById('closeResultBtn');
        const copyBtn = document.getElementById('copyBtn');
        const opData = document.getElementById('opData');
        const accountDetail = document.getElementById('accountDetail');
        const resultStatus = document.getElementById('resultStatus');
        
        // æ˜¾ç¤ºå¼¹çª—
        function showModal(modal) {
            modal.classList.add('active');
        }
        
        // éšè—å¼¹çª—
        function hideModal(modal) {
            modal.classList.remove('active');
        }
        
        // æ ¼å¼åŒ–æ—¶é—´æˆ³ä¸ºæ—¥æœŸæ—¶é—´æ ¼å¼
        function formatTimestamp(timestamp) {
            const date = new Date(parseInt(timestamp) * 1000); // è½¬æ¢ä¸ºæ¯«ç§’
            return date.toLocaleString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false
            }).replace(/\//g, '-'); // å°†æ–œæ æ›¿æ¢ä¸ºæ¨ªæ 
        }
        
        // è°ƒç”¨APIæ¥å£è·å–æ•°æ®
        async function fetchData(cardCode) {
            try {
                // æ˜¾ç¤ºåŠ è½½å¼¹çª—
                showModal(loadingModal);
                
                // è°ƒç”¨APIæ¥å£
                const response = await fetch(`http://103.99.106.48:8081/?km=${encodeURIComponent(cardCode)}`);
                
                // è§£æJSONæ•°æ®
                const data = await response.json();
                
                // éšè—åŠ è½½å¼¹çª—
                hideModal(loadingModal);
                
                // å¤„ç†è¿”å›ç»“æœ
                if (data.code === "0") {
                    // æˆåŠŸçŠ¶æ€
                    resultStatus.innerHTML = '<div class="success-tag">âœ… è·å–æˆåŠŸ</div>';
                    
                    // å¡«å……OPæ•°æ®
                    opData.textContent = `access_token=${data.access_token || 'unknown'}&expires_in=${data.expires_in || '7776000'}&openid=${data.openid || 'unknown'}&pay_token=${data.pay_token || 'unknown'}`;
                    
                    // å¡«å……è´¦å·è¯¦æƒ…
                    accountDetail.innerHTML = `
                        <p>æ˜µç§°ï¼š${data.æ˜µç§°} | ç­‰çº§ï¼š${data.level} | æ®µä½ï¼š${data.æ®µä½} | çƒ­åŠ›ï¼š${data.çƒ­åŠ›} | ç‹ç‰Œï¼š${data.ç‹ç‰Œ} | ä¸‹çº¿æ—¶é—´ï¼š${formatTimestamp(data.ä¸‹çº¿æ—¶é—´)}</p>
                    `;
                    
                    // æ˜¾ç¤ºç»“æœå¼¹çª—
                    showModal(resultModal);
                } else {
                    // é”™è¯¯çŠ¶æ€
                    resultStatus.innerHTML = `<div class="error-tag">âŒ ${data.errmsg || 'æŸ¥è¯¢å¤±è´¥'}</div>`;
                    opData.textContent = '';
                    accountDetail.innerHTML = '';
                    showModal(resultModal);
                }
            } catch (error) {
                // ç½‘ç»œé”™è¯¯å¤„ç†
                hideModal(loadingModal);
                resultStatus.innerHTML = `<div class="error-tag">âŒ æ¥å£è¯·æ±‚å¤±è´¥ï¼š${error.message}</div>`;
                opData.textContent = '';
                accountDetail.innerHTML = '';
                showModal(resultModal);
                console.error('APIè¯·æ±‚é”™è¯¯:', error);
            }
        }
        
        // æŸ¥è¯¢æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        queryBtn.addEventListener('click', function() {
            const code = cardCode.value.trim();
            if (!code) {
                alert('âŒè¯·è¾“å…¥æˆæƒå¡å¯†');
                return;
            }
            if (!code.startsWith('H')) {
                alert('âŒå¡å¯†é”™è¯¯');
                return;
            }
            
            // è°ƒç”¨APIè·å–æ•°æ®
            fetchData(code);
        });
        
        // å›è½¦é”®è§¦å‘æŸ¥è¯¢
        cardCode.addEventListener('keyup', function(e) {
            if (e.key === 'Enter') {
                queryBtn.click();
            }
        });
        
        // å…³é—­ç»“æœå¼¹çª—
        closeResultBtn.addEventListener('click', function() {
            hideModal(resultModal);
        });
        
        // å¤åˆ¶OPæ•°æ®
        copyBtn.addEventListener('click', function() {
            const textToCopy = opData.textContent.trim();
            if (!textToCopy) {
                alert('æ²¡æœ‰å¯å¤åˆ¶çš„æ•°æ®');
                return;
            }
            
            navigator.clipboard.writeText(textToCopy).then(() => {
                // å¤åˆ¶æˆåŠŸæç¤º
                const originalText = copyBtn.innerHTML;
                copyBtn.innerHTML = 'âœ… å·²å¤åˆ¶';
                setTimeout(() => {
                    copyBtn.innerHTML = originalText;
                }, 2000);
            }).catch(err => {
                console.error('å¤åˆ¶å¤±è´¥:', err);
                alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
            });
        });
    </script>
</body>
</html>